<!doctype html>
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>
<div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

<script type="text/javascript">
// $.get( "/data.csv", function( data ) {
//   if(data)
//   	tempinfo = data;
//   });
tempinfo = [{"temperature": 22.399999618530273, "timestamp": 1439107202, "humidity": 55.900001525878906, "device_name": "raspberry"}, {"temperature": 22.299999237060547, "timestamp": 1439109001, "humidity": 55.70000076293945, "device_name": "raspberry"}, {"temperature": 22.0, "timestamp": 1439110801, "humidity": 55.599998474121094, "device_name": "raspberry"}, {"temperature": 21.799999237060547, "timestamp": 1439112601, "humidity": 55.79999923706055, "device_name": "raspberry"}, {"temperature": 21.600000381469727, "timestamp": 1439114402, "humidity": 55.599998474121094, "device_name": "raspberry"}, {"temperature": 21.200000762939453, "timestamp": 1439116202, "humidity": 55.5, "device_name": "raspberry"}, {"temperature": 21.0, "timestamp": 1439118002, "humidity": 55.5, "device_name": "raspberry"}, {"temperature": 20.700000762939453, "timestamp": 1439119802, "humidity": 55.79999923706055, "device_name": "raspberry"}, {"temperature": 20.399999618530273, "timestamp": 1439121602, "humidity": 55.099998474121094, "device_name": "raspberry"}, {"temperature": 20.100000381469727, "timestamp": 1439123402, "device_name": "raspberry", "humidity": 55.29999923706055}, {"temperature": 19.799999237060547, "timestamp": 1439125202, "device_name": "raspberry", "humidity": 55.29999923706055}, {"temperature": 19.600000381469727, "timestamp": 1439127002, "device_name": "raspberry", "humidity": 55.79999923706055}, {"temperature": 19.200000762939453, "timestamp": 1439128802, "device_name": "raspberry", "humidity": 55.79999923706055}, {"temperature": 19.200000762939453, "timestamp": 1439130602, "device_name": "raspberry", "humidity": 56.0}, {"temperature": 19.100000381469727, "timestamp": 1439132402, "device_name": "raspberry", "humidity": 55.599998474121094}, {"temperature": 19.299999237060547, "timestamp": 1439134202, "device_name": "raspberry", "humidity": 55.900001525878906}, {"temperature": 19.600000381469727, "timestamp": 1439136002, "device_name": "raspberry", "humidity": 56.900001525878906}, {"temperature": 20.0, "timestamp": 1439137801, "device_name": "raspberry", "humidity": 58.400001525878906}, {"temperature": 20.299999237060547, "timestamp": 1439139601, "device_name": "raspberry", "humidity": 58.400001525878906}, {"temperature": 20.799999237060547, "timestamp": 1439141401, "device_name": "raspberry", "humidity": 57.5}, {"temperature": 21.799999237060547, "timestamp": 1439143202, "device_name": "raspberry", "humidity": 56.5}, {"temperature": 22.899999618530273, "timestamp": 1439145002, "device_name": "raspberry", "humidity": 55.5}, {"temperature": 25.399999618530273, "timestamp": 1439148602, "device_name": "raspberry", "humidity": 49.599998474121094}, {"temperature": 25.700000762939453, "timestamp": 1439149537, "device_name": "raspberry", "humidity": 49.0}, {"temperature": 26.0, "timestamp": 1439150405, "device_name": "raspberry", "humidity": 49.79999923706055}, {"temperature": 26.399999618530273, "timestamp": 1439152202, "device_name": "raspberry", "humidity": 50.79999923706055}, {"temperature": 26.5, "timestamp": 1439154002, "device_name": "raspberry", "humidity": 50.29999923706055}, {"temperature": 26.899999618530273, "timestamp": 1439155805, "device_name": "raspberry", "humidity": 48.900001525878906}, {"temperature": 27.299999237060547, "timestamp": 1439157605, "humidity": 50.099998474121094, "device_name": "raspberry"}, {"temperature": 27.700000762939453, "timestamp": 1439159404, "device_name": "raspberry", "humidity": 50.0}, {"temperature": 27.799999237060547, "timestamp": 1439161201, "device_name": "raspberry", "humidity": 49.900001525878906}, {"temperature": 27.899999618530273, "timestamp": 1439163002, "device_name": "raspberry", "humidity": 49.099998474121094}, {"temperature": 27.899999618530273, "timestamp": 1439164802, "device_name": "raspberry", "humidity": 48.900001525878906}, {"temperature": 27.899999618530273, "timestamp": 1439166602, "device_name": "raspberry", "humidity": 48.400001525878906}, {"temperature": 27.799999237060547, "timestamp": 1439168401, "device_name": "raspberry", "humidity": 48.70000076293945}, {"temperature": 27.5, "timestamp": 1439170202, "device_name": "raspberry", "humidity": 49.099998474121094}, {"temperature": 25.799999237060547, "timestamp": 1439172002, "device_name": "raspberry", "humidity": 52.400001525878906}, {"temperature": 25.0, "timestamp": 1439173802, "device_name": "raspberry", "humidity": 55.20000076293945}, {"temperature": 24.100000381469727, "timestamp": 1439175601, "device_name": "raspberry", "humidity": 57.599998474121094}, {"temperature": 24.799999237060547, "timestamp": 1439177405, "device_name": "raspberry", "humidity": 56.0}, {"temperature": 25.700000762939453, "timestamp": 1439179202, "humidity": 54.79999923706055, "device_name": "raspberry"}, {"temperature": 25.5, "timestamp": 1439181004, "humidity": 54.29999923706055, "device_name": "raspberry"}, {"temperature": 22.399999618530273, "timestamp": 1439182801, "humidity": 61.099998474121094, "device_name": "raspberry"}, {"temperature": 24.899999618530273, "timestamp": 1439184602, "humidity": 56.29999923706055, "device_name": "raspberry"}, {"temperature": 25.0, "timestamp": 1439186402, "humidity": 55.20000076293945, "device_name": "raspberry"}, {"temperature": 24.5, "timestamp": 1439188204, "humidity": 55.0, "device_name": "raspberry"}, {"temperature": 24.100000381469727, "timestamp": 1439190002, "humidity": 55.5, "device_name": "raspberry"}, {"temperature": 23.899999618530273, "timestamp": 1439191802, "humidity": 56.400001525878906, "device_name": "raspberry"}, {"temperature": 23.600000381469727, "timestamp": 1439193601, "humidity": 56.900001525878906, "device_name": "raspberry"}, {"temperature": 23.399999618530273, "timestamp": 1439195402, "humidity": 57.400001525878906, "device_name": "raspberry"}, {"temperature": 23.200000762939453, "timestamp": 1439197202, "humidity": 57.5, "device_name": "raspberry"}, {"temperature": 22.799999237060547, "timestamp": 1439199002, "humidity": 57.79999923706055, "device_name": "raspberry"}, {"temperature": 22.600000381469727, "timestamp": 1439200801, "humidity": 58.20000076293945, "device_name": "raspberry"}, {"temperature": 22.399999618530273, "timestamp": 1439202602, "humidity": 58.5, "device_name": "raspberry"}, {"temperature": 22.200000762939453, "timestamp": 1439204404, "humidity": 58.70000076293945, "device_name": "raspberry"}, {"temperature": 21.799999237060547, "timestamp": 1439206204, "humidity": 59.0, "device_name": "raspberry"}, {"temperature": 21.600000381469727, "timestamp": 1439208001, "humidity": 59.29999923706055, "device_name": "raspberry"}, {"temperature": 21.299999237060547, "timestamp": 1439209805, "humidity": 59.599998474121094, "device_name": "raspberry"}, {"temperature": 21.0, "timestamp": 1439211602, "humidity": 60.0, "device_name": "raspberry"}, {"temperature": 20.899999618530273, "timestamp": 1439213404, "humidity": 60.599998474121094, "device_name": "raspberry"}, {"temperature": 20.700000762939453, "timestamp": 1439215204, "humidity": 61.29999923706055, "device_name": "raspberry"}, {"temperature": 20.700000762939453, "timestamp": 1439217002, "humidity": 62.5, "device_name": "raspberry"}, {"temperature": 20.899999618530273, "timestamp": 1439218802, "humidity": 61.900001525878906, "device_name": "raspberry"}, {"temperature": 20.899999618530273, "timestamp": 1439220602, "humidity": 64.5999984741211, "device_name": "raspberry"}, {"temperature": 20.600000381469727, "timestamp": 1439222402, "humidity": 63.900001525878906, "device_name": "raspberry"}, {"temperature": 21.600000381469727, "timestamp": 1439224202, "humidity": 62.099998474121094, "device_name": "raspberry"}, {"temperature": 22.100000381469727, "timestamp": 1439226004, "humidity": 60.0, "device_name": "raspberry"}, {"temperature": 22.700000762939453, "timestamp": 1439227804, "humidity": 57.79999923706055, "device_name": "raspberry"}, {"temperature": 23.200000762939453, "timestamp": 1439229602, "humidity": 57.099998474121094, "device_name": "raspberry"}, {"temperature": 23.600000381469727, "timestamp": 1439231402, "humidity": 54.70000076293945, "device_name": "raspberry"}, {"temperature": 24.100000381469727, "timestamp": 1439233202, "humidity": 54.5, "device_name": "raspberry"}, {"temperature": 24.799999237060547, "timestamp": 1439235001, "humidity": 53.70000076293945, "device_name": "raspberry"}, {"temperature": 25.399999618530273, "timestamp": 1439236802, "humidity": 51.70000076293945, "device_name": "raspberry"}, {"temperature": 25.899999618530273, "timestamp": 1439238602, "humidity": 50.70000076293945, "device_name": "raspberry"}, {"temperature": 26.399999618530273, "timestamp": 1439240402, "humidity": 51.20000076293945, "device_name": "raspberry"}, {"temperature": 26.799999237060547, "timestamp": 1439242201, "humidity": 50.5, "device_name": "raspberry"}, {"temperature": 27.100000381469727, "timestamp": 1439244005, "humidity": 51.29999923706055, "device_name": "raspberry"}, {"temperature": 27.200000762939453, "timestamp": 1439245802, "humidity": 50.0, "device_name": "raspberry"}, {"temperature": 27.5, "timestamp": 1439247604, "humidity": 49.400001525878906, "device_name": "raspberry"}, {"temperature": 27.899999618530273, "timestamp": 1439249401, "humidity": 50.099998474121094, "device_name": "raspberry"}, {"temperature": 28.100000381469727, "timestamp": 1439251202, "humidity": 51.0, "device_name": "raspberry"}, {"temperature": 28.200000762939453, "timestamp": 1439253002, "humidity": 51.599998474121094, "device_name": "raspberry"}, {"temperature": 28.100000381469727, "timestamp": 1439254802, "humidity": 50.79999923706055, "device_name": "raspberry"}, {"temperature": 27.700000762939453, "timestamp": 1439256601, "humidity": 49.70000076293945, "device_name": "raspberry"}, {"temperature": 25.799999237060547, "timestamp": 1439258402, "humidity": 52.099998474121094, "device_name": "raspberry"}, {"temperature": 26.299999237060547, "timestamp": 1439260202, "humidity": 52.0, "device_name": "raspberry"}, {"temperature": 26.100000381469727, "timestamp": 1439262002, "humidity": 51.70000076293945, "device_name": "raspberry"}, {"temperature": 25.799999237060547, "timestamp": 1439263801, "humidity": 51.5, "device_name": "raspberry"}, {"temperature": 25.5, "timestamp": 1439265602, "humidity": 52.400001525878906, "device_name": "raspberry"}, {"temperature": 22.299999237060547, "timestamp": 1439267404, "humidity": 60.29999923706055, "device_name": "raspberry"}, {"temperature": 21.399999618530273, "timestamp": 1439269204, "humidity": 63.79999923706055, "device_name": "raspberry"}, {"temperature": 21.899999618530273, "timestamp": 1439271001, "humidity": 64.5999984741211, "device_name": "raspberry"}, {"temperature": 23.700000762939453, "timestamp": 1439272802, "humidity": 57.29999923706055, "device_name": "raspberry"}, {"temperature": 23.799999237060547, "timestamp": 1439274602, "humidity": 56.900001525878906, "device_name": "raspberry"}, {"temperature": 23.600000381469727, "timestamp": 1439276402, "humidity": 57.20000076293945, "device_name": "raspberry"}, {"temperature": 23.5, "timestamp": 1439278204, "humidity": 57.20000076293945, "device_name": "raspberry"}, {"temperature": 23.299999237060547, "timestamp": 1439280002, "humidity": 57.20000076293945, "device_name": "raspberry"}, {"temperature": 23.200000762939453, "timestamp": 1439281804, "humidity": 57.20000076293945, "device_name": "raspberry"}, {"temperature": 22.899999618530273, "timestamp": 1439283604, "device_name": "raspberry", "humidity": 56.70000076293945}, {"temperature": 22.600000381469727, "timestamp": 1439285405, "device_name": "raspberry", "humidity": 57.099998474121094}, {"temperature": 22.299999237060547, "timestamp": 1439287204, "device_name": "raspberry", "humidity": 57.5}, {"temperature": 22.0, "timestamp": 1439289002, "device_name": "raspberry", "humidity": 57.79999923706055}, {"temperature": 21.799999237060547, "timestamp": 1439290804, "device_name": "raspberry", "humidity": 57.900001525878906}, {"temperature": 21.600000381469727, "timestamp": 1439292602, "device_name": "raspberry", "humidity": 58.20000076293945}, {"temperature": 21.399999618530273, "timestamp": 1439294404, "device_name": "raspberry", "humidity": 58.400001525878906}, {"temperature": 21.299999237060547, "timestamp": 1439296202, "device_name": "raspberry", "humidity": 58.79999923706055}, {"temperature": 21.200000762939453, "timestamp": 1439298004, "device_name": "raspberry", "humidity": 59.20000076293945}, {"temperature": 21.100000381469727, "timestamp": 1439299805, "device_name": "raspberry", "humidity": 59.29999923706055}, {"temperature": 21.0, "timestamp": 1439301602, "device_name": "raspberry", "humidity": 59.599998474121094}, {"temperature": 20.899999618530273, "timestamp": 1439303402, "device_name": "raspberry", "humidity": 60.5}, {"temperature": 21.0, "timestamp": 1439305204, "device_name": "raspberry", "humidity": 60.599998474121094}, {"temperature": 21.299999237060547, "timestamp": 1439307002, "device_name": "raspberry", "humidity": 65.19999694824219}, {"temperature": 21.700000762939453, "timestamp": 1439308802, "device_name": "raspberry", "humidity": 65.5}, {"temperature": 21.899999618530273, "timestamp": 1439310602, "device_name": "raspberry", "humidity": 65.30000305175781}, {"temperature": 22.100000381469727, "timestamp": 1439312405, "device_name": "raspberry", "humidity": 63.20000076293945}, {"temperature": 22.399999618530273, "timestamp": 1439314205, "device_name": "raspberry", "humidity": 60.599998474121094}, {"temperature": 22.799999237060547, "timestamp": 1439316002, "device_name": "raspberry", "humidity": 59.20000076293945}, {"temperature": 23.299999237060547, "timestamp": 1439317804, "device_name": "raspberry", "humidity": 58.79999923706055}, {"temperature": 23.799999237060547, "timestamp": 1439319602, "device_name": "raspberry", "humidity": 57.20000076293945}, {"temperature": 24.600000381469727, "timestamp": 1439321404, "device_name": "raspberry", "humidity": 55.099998474121094}, {"temperature": 25.5, "timestamp": 1439323202, "device_name": "raspberry", "humidity": 53.400001525878906}, {"temperature": 26.399999618530273, "timestamp": 1439325004, "device_name": "raspberry", "humidity": 54.099998474121094}, {"temperature": 26.899999618530273, "timestamp": 1439326802, "device_name": "raspberry", "humidity": 52.79999923706055}, {"temperature": 27.200000762939453, "timestamp": 1439328602, "device_name": "raspberry", "humidity": 48.0}, {"temperature": 27.399999618530273, "timestamp": 1439330402, "device_name": "raspberry", "humidity": 46.0}, {"temperature": 27.600000381469727, "timestamp": 1439332204, "device_name": "raspberry", "humidity": 44.400001525878906}, {"temperature": 27.600000381469727, "timestamp": 1439334002, "device_name": "raspberry", "humidity": 41.599998474121094}, {"temperature": 27.600000381469727, "timestamp": 1439335802, "device_name": "raspberry", "humidity": 42.20000076293945}, {"temperature": 27.5, "timestamp": 1439337604, "device_name": "raspberry", "humidity": 43.400001525878906}, {"temperature": 27.299999237060547, "timestamp": 1439339404, "humidity": 43.70000076293945, "device_name": "raspberry"}, {"temperature": 26.399999618530273, "timestamp": 1439341202, "humidity": 45.29999923706055, "device_name": "raspberry"}];

console.log(tempinfo);
temperature = [];
timestamp = [];
humidity = [];
for(i=0; i<tempinfo.length;i++){
    if(tempinfo[i].temperature){
     temperature.push(parseFloat(tempinfo[i].temperature.toFixed(7)));
     timestamp.push(new Date(tempinfo[i].timestamp * 1000).getHours() + ':' + new Date(tempinfo[i].timestamp * 1000).getMinutes() + ':' + new Date(tempinfo[i].timestamp * 1000).getSeconds());
    
    humidity.push(parseFloat(tempinfo[i].humidity.toFixed(2)));
    }
       
}

            //console.log(temperature);
$(function () {
    $('#container').highcharts({
        title: {
            text: 'Monthly Average Temperature',
            x: -20 //center
        },
        subtitle: {
            text: 'Source: WorldClimate.com',
            x: -20
        },
        xAxis: {
            categories: timestamp
        },
        yAxis: {
            title: {
                text: 'Temperature (°C)'
            },
            plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
            }]
        },
        tooltip: {
        },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'middle',
            borderWidth: 0
        },
        series: [{
            name: 'Temparature (°C)', 
            data: temperature
        },{ name: 'Humidity (%)',
            data: humidity }]
    });
});


</script>

<body>
<title>BB's Smart Home</title>
<h1> Welcome to BB's Smart Home </h1>
{% if records %}
<h2>Temperature: {{ records.cur_temperature}}°C</h2>
<h2>Humidity: {{ records.cur_humidity}}%</h2>
{% endif %}
{% if records.timestamp_string %}
<h2>Last Recorded Time: {{ records.timestamp_string }} GMT</h2>
{% endif %}
</body>